<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>⚡ Live Odds Viewer</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0f;
            color: #e5e7eb;
            min-height: 100vh;
        }

        .container { max-width: 1920px; margin: 0 auto; padding: 24px; }

        /* Header */
        .header {
            background: #14141f;
            border: 1px solid #1f1f2e;
            border-radius: 12px;
            padding: 24px 32px;
            margin-bottom: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
        }

        .header-left { display: flex; align-items: center; gap: 24px; }

        .header h1 {
            font-size: 24px;
            font-weight: 700;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .fetching-indicator {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 8px 16px;
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            border-radius: 8px;
            font-size: 11px;
        }

        .fetching-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .fetching-icon {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: #6b7280;
        }

        .fetching-icon.active {
            background: #10b981;
            animation: pulse 2s infinite;
        }

        .fetching-icon.cached {
            background: #f59e0b;
        }

        .fetching-label {
            color: #9ca3af;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .fetching-label.active { color: #10b981; }
        .fetching-label.cached { color: #f59e0b; }

        .connection-status {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px 16px;
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            border-radius: 20px;
            font-size: 13px;
            font-weight: 600;
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-dot.connected { background: #10b981; box-shadow: 0 0 10px #10b981; }
        .status-dot.disconnected { background: #ef4444; }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.6; }
        }

        /* Search and Filters */
        .controls {
            background: #14141f;
            border: 1px solid #1f1f2e;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 24px;
        }

        .search-bar { 
            display: flex; 
            gap: 12px; 
            margin-bottom: 20px; 
            flex-wrap: wrap;
            align-items: stretch;
        }

        .search-input {
            flex: 1;
            min-width: 300px;
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            border-radius: 8px;
            padding: 12px 16px 12px 44px;
            color: #e5e7eb;
            font-size: 14px;
            transition: all 0.3s;
            position: relative;
        }

        .search-wrapper {
            flex: 1;
            min-width: 300px;
            position: relative;
        }

        .search-icon {
            position: absolute;
            left: 16px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            pointer-events: none;
        }

        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .search-input::placeholder { color: #6b7280; }

        .clear-btn {
            background: #ef4444;
            color: white;
            border: 1px solid #dc2626;
            border-radius: 8px;
            padding: 12px 24px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 8px;
            white-space: nowrap;
        }

        .clear-btn:hover { background: #dc2626; transform: scale(1.02); }

        .filters-wrapper {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .filter-row {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
            padding: 12px;
            background: #1a1a27;
            border-radius: 8px;
        }

        .filter-label {
            font-size: 12px;
            font-weight: 700;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            min-width: 80px;
        }

        .filter-buttons {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            flex: 1;
        }

        .filter-btn {
            background: #14141f;
            color: #9ca3af;
            border: 1px solid #2a2a3e;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .filter-btn:hover { background: #242435; border-color: #3b82f6; color: #3b82f6; }
        .filter-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; box-shadow: 0 0 12px rgba(59, 130, 246, 0.3); }

        .sport-chip {
            background: #14141f;
            color: #9ca3af;
            border: 1px solid #2a2a3e;
            border-radius: 6px;
            padding: 8px 16px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            white-space: nowrap;
        }

        .sport-chip:hover { background: #242435; border-color: #3b82f6; color: #3b82f6; }
        .sport-chip.active { background: #3b82f6; color: white; border-color: #3b82f6; box-shadow: 0 0 12px rgba(59, 130, 246, 0.3); }

        /* Stats Bar */
        .stats-bar {
            background: #14141f;
            border: 1px solid #1f1f2e;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 24px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 12px;
        }

        .stat-card {
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            border-radius: 8px;
            padding: 14px;
            text-align: center;
            transition: all 0.3s;
        }

        .stat-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 11px;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .stat-icon {
            font-size: 14px;
            margin-right: 4px;
            opacity: 0.6;
        }

        /* Status Indicators */
        .status-bar {
            background: #14141f;
            border: 1px solid #1f1f2e;
            border-radius: 12px;
            padding: 16px 20px;
            margin-bottom: 24px;
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            align-items: center;
            font-size: 12px;
        }

        .status-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            border-radius: 6px;
        }

        .status-item .dot { width: 6px; height: 6px; border-radius: 50%; background: #4b5563; }
        .status-item.active .dot { background: #10b981; box-shadow: 0 0 8px #10b981; }
        .last-update { margin-left: auto; color: #6b7280; font-style: italic; }

        /* Match Grid */
        .matches-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(340px, 1fr));
            gap: 20px;
            margin-bottom: 24px;
        }

        .match-card {
            background: #14141f;
            border: 1px solid #1f1f2e;
            border-radius: 12px;
            padding: 18px;
            cursor: pointer;
            transition: transform 0.2s ease, border-color 0.2s ease, box-shadow 0.2s ease, opacity 0.3s ease;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            gap: 12px;
            will-change: transform;
            contain: layout style paint;
            opacity: 1;
        }
        
        /* Smooth fade-in for new cards */
        .match-card.new-card {
            animation: fadeInCard 0.4s ease forwards;
        }
        
        @keyframes fadeInCard {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        /* Highlight updated cards briefly */
        .match-card.updated {
            animation: pulseUpdate 0.6s ease;
        }
        
        @keyframes pulseUpdate {
            0%, 100% {
                border-color: #1f1f2e;
            }
            50% {
                border-color: #3b82f6;
                box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
            }
        }

        .match-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6, #ec4899);
            opacity: 0;
            transition: opacity 0.2s ease;
        }

        .match-card:hover {
            border-color: #3b82f6;
            transform: translateY(-4px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.5);
        }

        .match-card:hover::before { opacity: 1; }

        .match-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-bottom: 12px;
            border-bottom: 1px solid #1f1f2e;
        }

        .sport-badge {
            font-size: 10px;
            font-weight: 700;
            color: #3b82f6;
            text-transform: uppercase;
            letter-spacing: 1px;
            padding: 6px 12px;
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 6px;
        }

        .live-indicator {
            background: #ef4444;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 10px;
            font-weight: 700;
            animation: blink 1.5s infinite;
            display: flex;
            align-items: center;
            gap: 6px;
            border: 1px solid #dc2626;
        }

        .live-indicator::before {
            content: '●';
            font-size: 14px;
            animation: pulse-dot 1.5s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.7; }
        }

        @keyframes pulse-dot {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(0.8); }
        }

        .match-teams { 
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
            padding: 8px 0;
        }

        .team {
            font-size: 14px;
            font-weight: 600;
            color: #ffffff;
            line-height: 1.4;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .team::before {
            content: '';
            width: 4px;
            height: 4px;
            background: #3b82f6;
            border-radius: 50%;
        }

        .vs-divider {
            font-size: 11px;
            color: #6b7280;
            font-weight: 700;
            text-align: center;
            padding: 4px 0;
            letter-spacing: 1px;
        }

        .live-score-display {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%);
            border: 2px solid #334155;
            border-radius: 12px;
            padding: 16px;
            margin: 12px 0;
            text-align: center;
        }

        .score-row {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 16px;
            margin-bottom: 8px;
        }

        .score-value {
            font-size: 32px;
            font-weight: 800;
            color: #ffffff;
            text-shadow: 0 2px 8px rgba(59, 130, 246, 0.3);
            line-height: 1;
        }

        .score-separator {
            font-size: 20px;
            font-weight: 600;
            color: #64748b;
        }

        .score-info {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            font-size: 11px;
            color: #94a3b8;
            font-weight: 600;
            flex-wrap: wrap;
        }

        .score-info span {
            display: flex;
            align-items: center;
            gap: 4px;
            padding: 4px 10px;
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.2);
            border-radius: 6px;
        }

        .score-info i {
            font-size: 9px;
        }

        .period-scores {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            margin: 8px 0;
            flex-wrap: wrap;
        }

        .period-score {
            font-size: 11px;
            font-weight: 600;
            color: #cbd5e1;
            padding: 4px 10px;
            background: rgba(100, 116, 139, 0.15);
            border: 1px solid rgba(100, 116, 139, 0.3);
            border-radius: 6px;
            cursor: help;
            transition: all 0.2s;
        }

        .period-score:hover {
            background: rgba(100, 116, 139, 0.25);
            border-color: rgba(100, 116, 139, 0.5);
        }

        /* Tennis-specific score display */
        .tennis-score {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            gap: 12px;
            align-items: center;
        }

        .tennis-player {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .tennis-player-name {
            font-size: 12px;
            font-weight: 600;
            color: #e2e8f0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .tennis-sets {
            display: flex;
            gap: 4px;
            justify-content: center;
        }

        .tennis-set {
            min-width: 24px;
            padding: 4px 6px;
            background: rgba(71, 85, 105, 0.3);
            border: 1px solid rgba(71, 85, 105, 0.5);
            border-radius: 4px;
            font-size: 12px;
            font-weight: 700;
            color: #94a3b8;
            text-align: center;
        }

        .tennis-set.winner {
            background: rgba(34, 197, 94, 0.2);
            border-color: rgba(34, 197, 94, 0.4);
            color: #4ade80;
        }

        .tennis-current-score {
            display: flex;
            flex-direction: column;
            gap: 4px;
            padding: 8px 12px;
            background: rgba(59, 130, 246, 0.15);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
        }

        .tennis-game-score {
            font-size: 24px;
            font-weight: 800;
            color: #3b82f6;
            line-height: 1;
        }

        .tennis-serve {
            width: 8px;
            height: 8px;
            background: #f59e0b;
            border-radius: 50%;
            animation: servePulse 1.5s ease infinite;
        }

        @keyframes servePulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.6; transform: scale(1.3); }
        }

        /* Sport-specific score layouts */
        .score-compact {
            font-size: 28px;
        }

        .score-large {
            font-size: 36px;
        }

        .match-info {
            font-size: 11px;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 12px;
            background: #1a1a27;
            border-radius: 6px;
        }

        .match-info span {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .match-info i { font-size: 10px; opacity: 0.7; }

        .match-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding-top: 8px;
            border-top: 1px solid #1f1f2e;
        }

        .bookmaker-badges { 
            display: flex; 
            gap: 6px; 
            flex-wrap: wrap;
        }

        .bookmaker-badge {
            padding: 5px 10px;
            border-radius: 5px;
            font-size: 9px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-bet365 { background: rgba(16, 185, 129, 0.15); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
        .badge-fanduel { background: rgba(59, 130, 246, 0.15); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }
        .badge-1xbet { background: rgba(249, 115, 22, 0.15); color: #f97316; border: 1px solid rgba(249, 115, 22, 0.3); }

        .sources-count {
            font-size: 11px;
            color: #9ca3af;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 10px;
            background: #1a1a27;
            border-radius: 6px;
        }

        .sources-count i { color: #3b82f6; }

        /* Pagination */
        .pagination-wrapper {
            background: #14141f;
            border: 1px solid #1f1f2e;
            border-radius: 12px;
            padding: 20px;
            margin-top: 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .pagination-info {
            font-size: 14px;
            color: #9ca3af;
            font-weight: 500;
        }

        .pagination-info strong {
            color: #ffffff;
            font-weight: 700;
        }

        .pagination-controls {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .page-btn {
            background: #1a1a27;
            color: #9ca3af;
            border: 1px solid #2a2a3e;
            border-radius: 6px;
            padding: 8px 12px;
            min-width: 40px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-btn:hover:not(:disabled) { background: #242435; border-color: #3b82f6; color: #3b82f6; }
        .page-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
        .page-btn:disabled { opacity: 0.4; cursor: not-allowed; }

        .page-size-selector {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .page-size-select {
            background: #1a1a27;
            color: #e5e7eb;
            border: 1px solid #2a2a3e;
            border-radius: 6px;
            padding: 8px 12px;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .page-size-select:hover { border-color: #3b82f6; }
        .page-size-select:focus { outline: none; border-color: #3b82f6; }

        .match-teams { margin-bottom: 12px; }

        .team {
            font-size: 15px;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 6px;
        }

        .vs-divider {
            font-size: 12px;
            color: #6b7280;
            font-weight: 600;
            text-align: center;
            margin: 8px 0;
        }

        .match-info {
            font-size: 12px;
            color: #6b7280;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bookmaker-badges { display: flex; gap: 6px; flex-wrap: wrap; }

        .bookmaker-badge {
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 10px;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .badge-bet365 { background: rgba(16, 185, 129, 0.15); color: #10b981; border: 1px solid rgba(16, 185, 129, 0.3); }
        .badge-fanduel { background: rgba(59, 130, 246, 0.15); color: #3b82f6; border: 1px solid rgba(59, 130, 246, 0.3); }
        .badge-1xbet { background: rgba(249, 115, 22, 0.15); color: #f97316; border: 1px solid rgba(249, 115, 22, 0.3); }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            z-index: 1000;
            animation: fadeIn 0.3s;
            overflow-y: auto;
            padding: 40px 20px;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal.show { display: flex; align-items: flex-start; justify-content: center; }

        .modal-content {
            background: #14141f;
            border: 1px solid #1f1f2e;
            border-radius: 16px;
            max-width: 1200px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .modal-header {
            background: #1a1a27;
            border-bottom: 1px solid #1f1f2e;
            padding: 28px 32px;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .modal-title {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 8px;
        }

        .modal-subtitle {
            font-size: 14px;
            color: #6b7280;
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .close-btn {
            position: absolute;
            top: 24px;
            right: 24px;
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            color: #9ca3af;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 20px;
        }

        .close-btn:hover { background: #ef4444; border-color: #ef4444; color: white; }

        .modal-body { padding: 32px; }

        .bookmaker-section {
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
        }

        .bookmaker-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid #2a2a3e;
        }

        .bookmaker-name {
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .bookmaker-icon {
            width: 32px;
            height: 32px;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 14px;
        }

        .icon-bet365 { background: rgba(16, 185, 129, 0.15); color: #10b981; }
        .icon-fanduel { background: rgba(59, 130, 246, 0.15); color: #3b82f6; }
        .icon-1xbet { background: rgba(249, 115, 22, 0.15); color: #f97316; }

        .odds-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .odds-type-card {
            background: #14141f;
            border: 1px solid #2a2a3e;
            border-radius: 8px;
            padding: 16px;
        }

        .odds-type-label {
            font-size: 12px;
            font-weight: 700;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .odds-values-grid { display: grid; gap: 8px; }

        .odds-value-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 12px;
            background: #1a1a27;
            border-radius: 6px;
        }

        .odds-team-label { font-size: 13px; color: #9ca3af; font-weight: 500; }
        .odds-value { font-size: 15px; font-weight: 700; color: #ffffff; }

        .no-data { text-align: center; color: #6b7280; padding: 60px 20px; grid-column: 1/-1; }
        .no-data i { font-size: 64px; margin-bottom: 16px; opacity: 0.3; }

        /* Scrollbar */
        ::-webkit-scrollbar { width: 8px; height: 8px; }
        ::-webkit-scrollbar-track { background: #1a1a27; }
        ::-webkit-scrollbar-thumb { background: #2a2a3e; border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: #3a3a4e; }

        /* Monitoring System */
        .monitoring-panel {
            position: fixed;
            bottom: 24px;
            right: 24px;
            z-index: 999;
        }

        .monitor-toggle {
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            font-size: 24px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .monitor-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 6px 20px rgba(59, 130, 246, 0.6);
        }

        .monitor-toggle.has-error {
            background: #ef4444;
            animation: shake 0.5s infinite;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-4px); }
            75% { transform: translateX(4px); }
        }

        .monitor-badge {
            position: absolute;
            top: -4px;
            right: -4px;
            background: #ef4444;
            color: white;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            font-size: 11px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #0a0a0f;
        }

        .monitor-window {
            position: fixed;
            bottom: 90px;
            right: 24px;
            width: 420px;
            max-height: 600px;
            background: #14141f;
            border: 1px solid #1f1f2e;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.6);
            display: none;
            flex-direction: column;
            z-index: 998;
        }

        .monitor-window.show { display: flex; }

        .monitor-header {
            background: #1a1a27;
            border-bottom: 1px solid #2a2a3e;
            padding: 16px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-radius: 12px 12px 0 0;
        }

        .monitor-title {
            font-size: 16px;
            font-weight: 700;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .monitor-close {
            background: transparent;
            border: none;
            color: #9ca3af;
            font-size: 20px;
            cursor: pointer;
            transition: color 0.3s;
        }

        .monitor-close:hover { color: #ffffff; }

        .monitor-content {
            flex: 1;
            overflow-y: auto;
            padding: 16px;
        }

        .monitor-section {
            margin-bottom: 16px;
        }

        .monitor-section-title {
            font-size: 12px;
            font-weight: 700;
            color: #6b7280;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 8px;
        }

        .clear-alerts-btn {
            background: transparent;
            border: 1px solid #2a2a3e;
            color: #9ca3af;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .clear-alerts-btn:hover {
            background: #ef4444;
            border-color: #ef4444;
            color: white;
        }

        .clear-alerts-btn i {
            font-size: 10px;
        }

        .alert-item {
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            border-left: 3px solid #ef4444;
            border-radius: 6px;
            padding: 12px;
            margin-bottom: 8px;
        }

        .alert-item.warning { border-left-color: #f59e0b; }
        .alert-item.info { border-left-color: #3b82f6; }
        .alert-item.success { border-left-color: #10b981; }

        .alert-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 6px;
        }

        .alert-title {
            font-size: 13px;
            font-weight: 600;
            color: #ffffff;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .alert-time {
            font-size: 10px;
            color: #6b7280;
        }

        .alert-message {
            font-size: 12px;
            color: #9ca3af;
            line-height: 1.4;
        }

        .email-config {
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            border-radius: 8px;
            padding: 12px;
        }

        .email-toggle {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 12px;
        }

        .email-toggle label {
            font-size: 13px;
            font-weight: 600;
            color: #e5e7eb;
        }

        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #2a2a3e;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .toggle-switch.active { background: #3b82f6; }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: transform 0.3s;
        }

        .toggle-switch.active::after { transform: translateX(20px); }

        .email-input {
            width: 100%;
            background: #14141f;
            border: 1px solid #2a2a3e;
            border-radius: 6px;
            padding: 8px 12px;
            color: #e5e7eb;
            font-size: 12px;
            margin-top: 8px;
        }

        .email-input:focus {
            outline: none;
            border-color: #3b82f6;
        }

        .monitor-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 8px;
        }

        .monitor-stat {
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            border-radius: 6px;
            padding: 10px;
            text-align: center;
        }

        .monitor-stat-value {
            font-size: 20px;
            font-weight: 700;
            color: #ffffff;
        }

        .monitor-stat-label {
            font-size: 10px;
            color: #6b7280;
            text-transform: uppercase;
            margin-top: 4px;
        }

        /* Monitoring Dashboard */
        .monitoring-dashboard {
            background: #14141f;
            border: 1px solid #1f1f2e;
            border-radius: 12px;
            margin-bottom: 24px;
            overflow: hidden;
        }

        .monitoring-header {
            padding: 16px 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            user-select: none;
            transition: background 0.2s;
        }

        .monitoring-header:hover {
            background: #1a1a27;
        }

        .monitoring-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: #ffffff;
        }

        .monitoring-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .monitoring-badge.active {
            background: #10b98133;
            color: #10b981;
        }

        .monitoring-badge.inactive {
            background: #ef444433;
            color: #ef4444;
        }

        .monitoring-content {
            padding: 0 24px 24px 24px;
            display: none;
        }

        .monitoring-content.show {
            display: block;
        }

        .monitoring-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
            margin-bottom: 24px;
        }

        .monitoring-card {
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            border-radius: 8px;
            padding: 16px;
        }

        .monitoring-card.warning {
            border-color: #f59e0b44;
        }

        .monitoring-card.error {
            border-color: #ef444444;
        }

        .monitoring-card-header {
            display: flex;
            align-items: center;
            gap: 8px;
            color: #9ca3af;
            font-size: 12px;
            margin-bottom: 12px;
        }

        .monitoring-value {
            font-size: 28px;
            font-weight: 700;
            color: #ffffff;
        }

        .module-status-list {
            background: #1a1a27;
            border: 1px solid #2a2a3e;
            border-radius: 8px;
            padding: 16px;
        }

        .module-status-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            border-bottom: 1px solid #2a2a3e;
        }

        .module-status-item:last-child {
            border-bottom: none;
        }

        .module-name {
            font-weight: 600;
            color: #ffffff;
        }

        .module-info {
            display: flex;
            align-items: center;
            gap: 16px;
            font-size: 12px;
        }

        .module-status-badge {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            text-transform: uppercase;
        }

        .module-status-badge.healthy {
            background: #10b98133;
            color: #10b981;
        }

        .module-status-badge.warning {
            background: #f59e0b33;
            color: #f59e0b;
        }

        .module-status-badge.error {
            background: #ef444433;
            color: #ef4444;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .matches-grid { grid-template-columns: 1fr; }
            .modal-content { margin: 20px; }
            .odds-grid { grid-template-columns: 1fr; }
            .monitor-window { 
                width: calc(100vw - 48px); 
                right: 24px; 
                left: 24px;
            }
            .monitoring-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- Header -->
        <div class="header">
            <div class="header-left">
                <h1><i class="fas fa-bolt"></i> Live Odds Viewer</h1>
                <div class="fetching-indicator">
                    <div class="fetching-row">
                        <div class="fetching-icon" id="pregameFetchIcon"></div>
                        <span class="fetching-label" id="pregameFetchLabel">Pregame: Initializing...</span>
                    </div>
                    <div class="fetching-row">
                        <div class="fetching-icon" id="liveFetchIcon"></div>
                        <span class="fetching-label" id="liveFetchLabel">Live: Initializing...</span>
                    </div>
                </div>
                <div class="connection-status">
                    <div class="status-dot disconnected" id="connectionDot"></div>
                    <span id="connectionText">Connecting...</span>
                </div>
            </div>
        </div>

        <!-- Monitoring Dashboard -->
        <div id="monitoringDashboard" class="monitoring-dashboard" style="display: none;">
            <div class="monitoring-header" onclick="toggleMonitoring()">
                <div style="display: flex; align-items: center; gap: 12px;">
                    <i class="fas fa-heartbeat"></i>
                    <h3>System Monitoring</h3>
                    <span class="monitoring-badge" id="monitoringBadge">Checking...</span>
                    <span style="font-size: 0.85rem; color: #888; margin-left: auto;" id="monitoringLastUpdate">-</span>
                </div>
                <i class="fas fa-chevron-down" id="monitoringChevron"></i>
            </div>
            <div class="monitoring-content" id="monitoringContent">
                <div class="monitoring-grid">
                    <div class="monitoring-card">
                        <div class="monitoring-card-header">
                            <i class="fas fa-check-circle"></i>
                            <span>Healthy Modules</span>
                        </div>
                        <div class="monitoring-value" id="healthyCount">-</div>
                    </div>
                    <div class="monitoring-card warning">
                        <div class="monitoring-card-header">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Warnings</span>
                        </div>
                        <div class="monitoring-value" id="warningCount">-</div>
                    </div>
                    <div class="monitoring-card error">
                        <div class="monitoring-card-header">
                            <i class="fas fa-times-circle"></i>
                            <span>Errors</span>
                        </div>
                        <div class="monitoring-value" id="errorCount">-</div>
                    </div>
                    <div class="monitoring-card">
                        <div class="monitoring-card-header">
                            <i class="fas fa-envelope"></i>
                            <span>Email Alerts</span>
                        </div>
                        <div class="monitoring-value" id="emailStatus">-</div>
                    </div>
                </div>
                <div class="module-status-list" id="moduleStatusList">
                    <!-- Module statuses will be populated here -->
                </div>
            </div>
        </div>

        <!-- Search and Filters -->
        <div class="controls">
            <div class="search-bar">
                <div class="search-wrapper">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" id="searchInput" placeholder="Search teams, sports, or matches...">
                </div>
                <button class="clear-btn" onclick="clearAllFilters()">
                    <i class="fas fa-redo"></i> Reset All
                </button>
            </div>
            
            <div class="filters-wrapper">
                <div class="filter-row">
                    <span class="filter-label">Match Type:</span>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-type="all" onclick="setMatchTypeFilter('all')">All Matches</button>
                        <button class="filter-btn" data-type="live" onclick="setMatchTypeFilter('live')">
                            <i class="fas fa-circle"></i> Live Only
                        </button>
                        <button class="filter-btn" data-type="pregame" onclick="setMatchTypeFilter('pregame')">
                            <i class="fas fa-clock"></i> Pregame Only
                        </button>
                    </div>
                </div>

                <div class="filter-row">
                    <span class="filter-label">Sources:</span>
                    <div class="filter-buttons">
                        <button class="filter-btn active" data-filter="all" onclick="setSourceFilter('all')">All Sources</button>
                        <button class="filter-btn" data-filter="bet365" onclick="setSourceFilter('bet365')">
                            <i class="fas fa-check-circle"></i> Bet365
                        </button>
                        <button class="filter-btn" data-filter="fanduel" onclick="setSourceFilter('fanduel')">
                            <i class="fas fa-check-circle"></i> FanDuel
                        </button>
                        <button class="filter-btn" data-filter="1xbet" onclick="setSourceFilter('1xbet')">
                            <i class="fas fa-check-circle"></i> 1xBet
                        </button>
                        <button class="filter-btn" data-filter="multi" onclick="setSourceFilter('multi')">2+ Sources</button>
                        <button class="filter-btn" data-filter="triple" onclick="setSourceFilter('triple')">All 3 Sources</button>
                    </div>
                </div>

                <div class="filter-row">
                    <span class="filter-label">Sports:</span>
                    <div class="filter-buttons" id="sportFilter">
                        <span class="sport-chip active" onclick="setSportFilter('all')">All Sports</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats -->
        <div class="stats-bar">
            <div class="stat-card">
                <div class="stat-value" id="totalMatches">0</div>
                <div class="stat-label"><i class="fas fa-list stat-icon"></i>Total Matches</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="pregameMatches">0</div>
                <div class="stat-label"><i class="fas fa-clock stat-icon"></i>Pregame</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="liveMatches">0</div>
                <div class="stat-label"><i class="fas fa-circle stat-icon"></i>Live</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="twoSourceMatches">0</div>
                <div class="stat-label"><i class="fas fa-layer-group stat-icon"></i>2 Sources</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="threeSourceMatches">0</div>
                <div class="stat-label"><i class="fas fa-trophy stat-icon"></i>3 Sources</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="filteredCount">0</div>
                <div class="stat-label"><i class="fas fa-filter stat-icon"></i>Showing</div>
            </div>
        </div>

        <!-- Status Bar -->
        <div class="status-bar" id="statusBar">
            <div class="status-item" id="status-bet365_pregame"><div class="dot"></div><span>Bet365 Pregame</span></div>
            <div class="status-item" id="status-bet365_live"><div class="dot"></div><span>Bet365 Live</span></div>
            <div class="status-item" id="status-fanduel_pregame"><div class="dot"></div><span>FanDuel Pregame</span></div>
            <div class="status-item" id="status-fanduel_live"><div class="dot"></div><span>FanDuel Live</span></div>
            <div class="status-item" id="status-1xbet_pregame"><div class="dot"></div><span>1xBet Pregame</span></div>
            <div class="status-item" id="status-1xbet_live"><div class="dot"></div><span>1xBet Live</span></div>
            <div class="last-update" id="lastUpdate">Last update: --</div>
        </div>

        <!-- Matches Grid -->
        <div class="matches-grid" id="matchesGrid">
            <div class="no-data">
                <i class="fas fa-clock"></i>
                <h3>Waiting for data...</h3>
                <p>Monitoring odds files for updates</p>
            </div>
        </div>

        <!-- Pagination -->
        <div class="pagination-wrapper" id="paginationWrapper" style="display: none;">
            <div class="pagination-info">
                Showing <strong id="pageStart">0</strong> to <strong id="pageEnd">0</strong> of <strong id="pageTotal">0</strong> matches
            </div>
            <div class="pagination-controls">
                <button class="page-btn" id="prevPage" onclick="changePage(-1)">
                    <i class="fas fa-chevron-left"></i>
                </button>
                <div id="pageNumbers"></div>
                <button class="page-btn" id="nextPage" onclick="changePage(1)">
                    <i class="fas fa-chevron-right"></i>
                </button>
            </div>
            <div class="page-size-selector">
                <span style="font-size: 13px; color: #9ca3af;">Per page:</span>
                <select class="page-size-select" id="pageSize" onchange="changePageSize()">
                    <option value="12">12</option>
                    <option value="24" selected>24</option>
                    <option value="36">36</option>
                    <option value="48">48</option>
                    <option value="999999">All</option>
                </select>
            </div>
        </div>

        <!-- Modal for Match Details -->
        <div class="modal" id="matchModal" onclick="if(event.target === this) closeModal()">
            <div class="modal-content">
                <div class="modal-header">
                    <div>
                        <div class="modal-title" id="modalTitle">Match Details</div>
                        <div class="modal-subtitle" id="modalSubtitle"></div>
                    </div>
                    <button class="close-btn" onclick="closeModal()"><i class="fas fa-times"></i></button>
                </div>
                <div class="modal-body" id="modalBody"></div>
            </div>
        </div>

        <!-- Monitoring System -->
        <div class="monitoring-panel">
            <button class="monitor-toggle" id="monitorToggle" onclick="toggleMonitor()">
                <i class="fas fa-heartbeat"></i>
                <span class="monitor-badge" id="monitorBadge" style="display: none;">0</span>
            </button>

            <div class="monitor-window" id="monitorWindow">
                <div class="monitor-header">
                    <div class="monitor-title">
                        <i class="fas fa-shield-alt"></i> System Monitor
                    </div>
                    <button class="monitor-close" onclick="toggleMonitor()">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="monitor-content">
                    <!-- Health Stats -->
                    <div class="monitor-section">
                        <div class="monitor-section-title">System Health</div>
                        <div class="monitor-stats">
                            <div class="monitor-stat">
                                <div class="monitor-stat-value" id="uptimeValue">0m</div>
                                <div class="monitor-stat-label">Uptime</div>
                            </div>
                            <div class="monitor-stat">
                                <div class="monitor-stat-value" id="errorCount">0</div>
                                <div class="monitor-stat-label">Errors</div>
                            </div>
                            <div class="monitor-stat">
                                <div class="monitor-stat-value" id="updateCount">0</div>
                                <div class="monitor-stat-label">Updates</div>
                            </div>
                            <div class="monitor-stat">
                                <div class="monitor-stat-value" id="healthScore">100%</div>
                                <div class="monitor-stat-label">Health</div>
                            </div>
                        </div>
                    </div>

                    <!-- Email Notifications -->
                    <div class="monitor-section">
                        <div class="monitor-section-title">Email Alerts</div>
                        <div class="email-config">
                            <div class="email-toggle">
                                <label>Enable Email Notifications</label>
                                <div class="toggle-switch" id="emailToggle" onclick="toggleEmail()"></div>
                            </div>
                            <input type="email" class="email-input" id="emailInput" placeholder="Enter your email address" disabled>
                        </div>
                    </div>

                    <!-- Alerts -->
                    <div class="monitor-section">
                        <div class="monitor-section-title" style="display: flex; justify-content: space-between; align-items: center;">
                            <span>Recent Alerts</span>
                            <button class="clear-alerts-btn" onclick="clearAlerts()" title="Clear all notifications">
                                <i class="fas fa-trash-alt"></i> Clear All
                            </button>
                        </div>
                        <div id="alertsList">
                            <div class="alert-item success">
                                <div class="alert-header">
                                    <div class="alert-title">
                                        <i class="fas fa-check-circle"></i> System Online
                                    </div>
                                    <div class="alert-time" id="startTime">Just now</div>
                                </div>
                                <div class="alert-message">All modules are functioning normally</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let ws = null;
        let allMatches = [];
        let filteredMatches = [];
        let currentSourceFilter = 'all';
        let currentSportFilter = 'all';
        let currentMatchTypeFilter = 'all';
        let searchQuery = '';
        let availableSports = new Set();
        let lastDataString = '';
        
        // Pagination
        let currentPage = 1;
        let pageSize = 24;
        let totalPages = 1;

        // Monitoring System
        let monitoringEnabled = true;
        let emailEnabled = false;
        let emailAddress = '';
        let alerts = [];
        let errorCount = 0;
        let updateCount = 0;
        let startTime = Date.now();
        let lastUpdateTime = Date.now();
        let lastPregameUpdate = null;
        let lastLiveUpdate = null;
        let moduleStatus = {
            bet365_pregame: { healthy: false, lastSeen: null, errors: [] },
            bet365_live: { healthy: false, lastSeen: null, errors: [] },
            fanduel_pregame: { healthy: false, lastSeen: null, errors: [] },
            fanduel_live: { healthy: false, lastSeen: null, errors: [] },
            '1xbet_pregame': { healthy: false, lastSeen: null, errors: [] },
            '1xbet_live': { healthy: false, lastSeen: null, errors: [] }
        };

        // Check module health
        function checkModuleHealth() {
            const now = Date.now();
            const staleThreshold = 5 * 60 * 1000; // 5 minutes
            let healthyModules = 0;
            let totalModules = Object.keys(moduleStatus).length;

            for (const [module, status] of Object.entries(moduleStatus)) {
                const timeSinceUpdate = status.lastSeen ? now - status.lastSeen : Infinity;
                
                if (timeSinceUpdate > staleThreshold && status.healthy) {
                    status.healthy = false;
                    addAlert('warning', `${module} Stale`, `No updates received for ${Math.floor(timeSinceUpdate / 60000)} minutes`);
                }

                if (status.healthy) healthyModules++;
            }

            const healthPercentage = Math.round((healthyModules / totalModules) * 100);
            document.getElementById('healthScore').textContent = healthPercentage + '%';

            // Update uptime
            const uptimeMinutes = Math.floor((now - startTime) / 60000);
            const uptimeHours = Math.floor(uptimeMinutes / 60);
            const uptimeDisplay = uptimeHours > 0 ? `${uptimeHours}h ${uptimeMinutes % 60}m` : `${uptimeMinutes}m`;
            document.getElementById('uptimeValue').textContent = uptimeDisplay;

            return healthPercentage;
        }

        function addAlert(type, title, message) {
            const now = new Date();
            const alert = {
                type,
                title,
                message,
                timestamp: now
            };
            
            alerts.unshift(alert);
            if (alerts.length > 10) alerts = alerts.slice(0, 10);

            // Only count errors, not warnings or info for the badge
            if (type === 'error') {
                errorCount++;
                document.getElementById('errorCount').textContent = errorCount;
                document.getElementById('monitorBadge').textContent = errorCount;
                document.getElementById('monitorBadge').style.display = 'flex';
                document.getElementById('monitorToggle').classList.add('has-error');

                // Send email if enabled
                if (emailEnabled && emailAddress) {
                    sendEmailAlert(alert);
                }
            } else if (type === 'warning' && emailEnabled && emailAddress) {
                // Send email for warnings if enabled (but don't increment error count)
                sendEmailAlert(alert);
            }

            // Immediate render for real-time feel
            renderAlerts();
        }

        function renderAlerts() {
            const container = document.getElementById('alertsList');
            if (alerts.length === 0) {
                container.innerHTML = '<div class="alert-item success"><div class="alert-message">No alerts</div></div>';
                return;
            }

            // Direct update for real-time alerts
            container.innerHTML = alerts.map(alert => {
                const timeStr = formatTimeAgo(alert.timestamp);
                const iconMap = {
                    error: 'fa-exclamation-circle',
                    warning: 'fa-exclamation-triangle',
                    info: 'fa-info-circle',
                    success: 'fa-check-circle'
                };

                return `
                    <div class="alert-item ${alert.type}">
                        <div class="alert-header">
                            <div class="alert-title">
                                <i class="fas ${iconMap[alert.type]}"></i> ${alert.title}
                            </div>
                            <div class="alert-time">${timeStr}</div>
                        </div>
                        <div class="alert-message">${alert.message}</div>
                    </div>
                `;
            }).join('');
        }

        function formatTimeAgo(date) {
            const seconds = Math.floor((Date.now() - date) / 1000);
            if (seconds < 60) return 'Just now';
            const minutes = Math.floor(seconds / 60);
            if (minutes < 60) return `${minutes}m ago`;
            const hours = Math.floor(minutes / 60);
            return `${hours}h ago`;
        }

        function sendEmailAlert(alert) {
            // Call backend API to send email
            fetch('/api/send-email', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ email: emailAddress, alert })
            })
            .then(response => response.json())
            .then(data => {
                console.log('Email alert sent:', data);
            })
            .catch(error => {
                console.error('Failed to send email alert:', error);
            });
        }

        function toggleMonitor() {
            const window = document.getElementById('monitorWindow');
            window.classList.toggle('show');
        }

        function clearAlerts() {
            alerts = [];
            const container = document.getElementById('alertsList');
            container.innerHTML = `
                <div class="alert-item success">
                    <div class="alert-header">
                        <div class="alert-title">
                            <i class="fas fa-check-circle"></i> Notifications Cleared
                        </div>
                        <div class="alert-time">Just now</div>
                    </div>
                    <div class="alert-message">All notifications have been cleared</div>
                </div>
            `;
            
            // Reset badge
            const badge = document.getElementById('monitorBadge');
            badge.style.display = 'none';
            badge.textContent = '0';
            
            // Clear error count
            errorCount = 0;
            document.getElementById('errorCount').textContent = errorCount;
        }

        function toggleEmail() {
            emailEnabled = !emailEnabled;
            const toggle = document.getElementById('emailToggle');
            const input = document.getElementById('emailInput');
            
            toggle.classList.toggle('active');
            input.disabled = !emailEnabled;
            
            if (emailEnabled) {
                input.focus();
                addAlert('info', 'Email Alerts Enabled', 'You will receive notifications for critical issues');
            } else {
                addAlert('info', 'Email Alerts Disabled', 'Email notifications have been turned off');
            }
        }

        document.getElementById('emailInput')?.addEventListener('change', (e) => {
            emailAddress = e.target.value;
            if (emailAddress && emailEnabled) {
                addAlert('success', 'Email Configured', `Alerts will be sent to ${emailAddress}`);
            }
        });

        // Monitor health check interval (reduced frequency)
        setInterval(() => {
            if (monitoringEnabled) {
                checkModuleHealth();
            }
        }, 60000); // Check every 60 seconds (reduced from 30)

        // Connect to WebSocket with retry limit
        let reconnectAttempts = 0;
        const maxReconnectAttempts = 3;
        let reconnectTimeout = null;

        function connect() {
            // Cancel any pending reconnection
            if (reconnectTimeout) {
                clearTimeout(reconnectTimeout);
                reconnectTimeout = null;
            }

            ws = new WebSocket(`ws://${window.location.host}/ws`);
            
            ws.onopen = () => {
                reconnectAttempts = 0; // Reset on successful connection
                document.getElementById('connectionDot').className = 'status-dot connected';
                document.getElementById('connectionText').textContent = 'Connected';
                addAlert('success', 'WebSocket Connected', 'Real-time updates are active');
            };

            ws.onclose = () => {
                document.getElementById('connectionDot').className = 'status-dot disconnected';
                document.getElementById('connectionText').textContent = 'Disconnected';
                
                // Only show alert and reconnect if we haven't exceeded max attempts
                if (reconnectAttempts < maxReconnectAttempts) {
                    addAlert('warning', 'WebSocket Disconnected', `Attempting to reconnect (${reconnectAttempts + 1}/${maxReconnectAttempts})...`);
                    reconnectAttempts++;
                    reconnectTimeout = setTimeout(connect, 3000);
                } else {
                    // Stop trying - system is offline
                    addAlert('info', 'System Offline', 'UI is running in offline mode. Start the backend to enable real-time updates.');
                    document.getElementById('connectionText').textContent = 'Offline Mode';
                }
            };

            ws.onerror = (error) => {
                // Only show error if we're still trying to connect
                if (reconnectAttempts < maxReconnectAttempts) {
                    addAlert('error', 'WebSocket Error', 'Connection error occurred');
                }
            };

            ws.onmessage = (event) => {
                const message = JSON.parse(event.data);
                
                if (message.type === 'data_update') {
                    const dataString = JSON.stringify(message.data);
                    if (dataString !== lastDataString) {  // Only update if data changed
                        lastDataString = dataString;
                        handleDataUpdate(message.data);
                    }
                } else if (message.type === 'status_update') {
                    handleStatusUpdate(message.status);
                }

                document.getElementById('lastUpdate').textContent = 
                    `Last update: ${new Date(message.timestamp).toLocaleTimeString()}`;
            };
        }

        function handleDataUpdate(data) {
            allMatches = [
                ...(data.pregame_matches || []),
                ...(data.live_matches || [])
            ];

            updateCount++;
            document.getElementById('updateCount').textContent = updateCount;
            lastUpdateTime = Date.now();

            // Track pregame and live updates separately
            const now = Date.now();
            const hasNewPregame = (data.pregame_matches || []).length > 0;
            const hasNewLive = (data.live_matches || []).length > 0;

            // Update pregame fetching status
            if (hasNewPregame) {
                lastPregameUpdate = now;
                updateFetchingStatus('pregame', true);
            } else {
                // Check if data is stale
                const pregameStale = lastPregameUpdate && (now - lastPregameUpdate > 60000); // 1 min
                updateFetchingStatus('pregame', false, pregameStale);
            }

            // Update live fetching status
            if (hasNewLive) {
                lastLiveUpdate = now;
                updateFetchingStatus('live', true);
            } else {
                // Check if data is stale
                const liveStale = lastLiveUpdate && (now - lastLiveUpdate > 60000); // 1 min
                updateFetchingStatus('live', false, liveStale);
            }

            // Throttle alerts - only show data quality issues every 5 minutes
            const timeSinceLastAlert = now - (window.lastDataQualityAlert || 0);
            if (timeSinceLastAlert > 300000) { // 5 minutes
                // Check for data quality issues
                if (allMatches.length === 0 && updateCount > 5) {
                    addAlert('warning', 'No Matches Available', 'All data sources are returning empty results');
                    window.lastDataQualityAlert = now;
                }

                // Check if any matches have missing odds
                const matchesWithIssues = allMatches.filter(m => {
                    const sources = [m.bet365?.available, m.fanduel?.available, m['1xbet']?.available];
                    return sources.filter(Boolean).length === 0;
                });

                if (matchesWithIssues.length > 0 && updateCount > 3) {
                    addAlert('warning', 'Data Quality Issue', `${matchesWithIssues.length} matches have no odds from any source`);
                    window.lastDataQualityAlert = now;
                }
            }

            updateStats(data);
            extractSports();
            applyFilters();
        }

        function updateFetchingStatus(type, isActive, isStale = false) {
            const iconId = type === 'pregame' ? 'pregameFetchIcon' : 'liveFetchIcon';
            const labelId = type === 'pregame' ? 'pregameFetchLabel' : 'liveFetchLabel';
            const icon = document.getElementById(iconId);
            const label = document.getElementById(labelId);
            
            if (isActive) {
                icon.className = 'fetching-icon active';
                label.className = 'fetching-label active';
                label.textContent = `${type === 'pregame' ? 'Pregame' : 'Live'}: Real-time Fetching ✓`;
            } else if (isStale) {
                icon.className = 'fetching-icon cached';
                label.className = 'fetching-label cached';
                label.textContent = `${type === 'pregame' ? 'Pregame' : 'Live'}: Cached Data (Stale)`;
            } else {
                icon.className = 'fetching-icon cached';
                label.className = 'fetching-label cached';
                label.textContent = `${type === 'pregame' ? 'Pregame' : 'Live'}: From JSON Files`;
            }
        }

        function handleStatusUpdate(status) {
            const now = Date.now();
            
            for (const [source, info] of Object.entries(status)) {
                const element = document.getElementById(`status-${source}`);
                if (element) {
                    if (info.exists) {
                        element.classList.add('active');
                        
                        // Update module status
                        if (moduleStatus[source]) {
                            const wasHealthy = moduleStatus[source].healthy;
                            moduleStatus[source].healthy = true;
                            moduleStatus[source].lastSeen = now;
                            
                            // If module recovered
                            if (!wasHealthy && moduleStatus[source].errors.length > 0) {
                                addAlert('success', `${source} Recovered`, 'Module is now functioning normally');
                                moduleStatus[source].errors = [];
                            }
                        }
                    } else {
                        element.classList.remove('active');
                        
                        // Mark module as unhealthy
                        if (moduleStatus[source] && moduleStatus[source].healthy) {
                            moduleStatus[source].healthy = false;
                            addAlert('error', `${source} Failed`, 'Data source is not available');
                            moduleStatus[source].errors.push({ time: now, reason: 'File not found' });
                        }
                    }
                }
            }
            
            checkModuleHealth();
        }

        function updateStats(data) {
            const pregame = data.pregame_matches?.length || 0;
            const live = data.live_matches?.length || 0;
            const total = pregame + live;

            // Count matches with 2 or 3 sources
            let twoSourceCount = 0;
            let threeSourceCount = 0;
            
            allMatches.forEach(m => {
                const sources = [m.bet365?.available, m.fanduel?.available, m['1xbet']?.available].filter(Boolean);
                if (sources.length === 2) twoSourceCount++;
                if (sources.length === 3) threeSourceCount++;
            });

            document.getElementById('totalMatches').textContent = total;
            document.getElementById('pregameMatches').textContent = pregame;
            document.getElementById('liveMatches').textContent = live;
            document.getElementById('twoSourceMatches').textContent = twoSourceCount;
            document.getElementById('threeSourceMatches').textContent = threeSourceCount;
        }

        function extractSports() {
            availableSports.clear();
            allMatches.forEach(m => {
                if (m.sport && m.sport.trim()) {  // Only add non-empty sports
                    availableSports.add(m.sport);
                }
            });
            
            const sportFilter = document.getElementById('sportFilter');
            const sortedSports = Array.from(availableSports).sort();
            
            sportFilter.innerHTML = `
                <span class="sport-chip ${currentSportFilter === 'all' ? 'active' : ''}" onclick="setSportFilter('all')">All Sports</span>
                ${sortedSports.map(sport => 
                    `<span class="sport-chip ${currentSportFilter === sport ? 'active' : ''}" onclick="setSportFilter('${sport.replace(/'/g, "\\'")}')">${sport}</span>`
                ).join('')}
            `;
        }

        function setSourceFilter(filter) {
            currentSourceFilter = filter;
            document.querySelectorAll('[data-filter]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filter === filter);
            });
            applyFilters();
        }

        function setSportFilter(sport) {
            currentSportFilter = sport;
            // Re-render the sports filter to update active states
            extractSports();
            applyFilters();
        }

        function setMatchTypeFilter(type) {
            currentMatchTypeFilter = type;
            document.querySelectorAll('[data-type]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === type);
            });
            applyFilters();
        }

        function clearAllFilters() {
            currentSourceFilter = 'all';
            currentSportFilter = 'all';
            currentMatchTypeFilter = 'all';
            searchQuery = '';
            document.getElementById('searchInput').value = '';
            
            document.querySelectorAll('[data-filter]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.filter === 'all');
            });
            document.querySelectorAll('[data-type]').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.type === 'all');
            });
            
            extractSports();
            applyFilters();
        }

        function applyFilters() {
            let filtered = allMatches;

            // Match type filter (live/pregame)
            if (currentMatchTypeFilter === 'live') {
                filtered = filtered.filter(m => m.is_live === true);
            } else if (currentMatchTypeFilter === 'pregame') {
                filtered = filtered.filter(m => m.is_live !== true);
            }

            // Source filter
            if (currentSourceFilter === 'bet365') {
                filtered = filtered.filter(m => m.bet365?.available);
            } else if (currentSourceFilter === 'fanduel') {
                filtered = filtered.filter(m => m.fanduel?.available);
            } else if (currentSourceFilter === '1xbet') {
                filtered = filtered.filter(m => m['1xbet']?.available);
            } else if (currentSourceFilter === 'multi') {
                filtered = filtered.filter(m => {
                    const count = [m.bet365?.available, m.fanduel?.available, m['1xbet']?.available].filter(Boolean).length;
                    return count >= 2;
                });
            } else if (currentSourceFilter === 'triple') {
                filtered = filtered.filter(m =>
                    m.bet365?.available && m.fanduel?.available && m['1xbet']?.available
                );
            }

            // Sport filter
            if (currentSportFilter !== 'all') {
                filtered = filtered.filter(m => m.sport === currentSportFilter);
            }

            // Search filter
            if (searchQuery) {
                const query = searchQuery.toLowerCase();
                filtered = filtered.filter(m =>
                    m.home_team.toLowerCase().includes(query) ||
                    m.away_team.toLowerCase().includes(query) ||
                    m.sport.toLowerCase().includes(query)
                );
            }

            filteredMatches = filtered;
            currentPage = 1; // Reset to first page when filters change
            document.getElementById('filteredCount').textContent = filtered.length;
            updatePagination();
            displayMatches();
        }

        function updatePagination() {
            const total = filteredMatches.length;
            totalPages = Math.ceil(total / pageSize) || 1;
            
            if (totalPages === 1 && total > 0) {
                document.getElementById('paginationWrapper').style.display = 'none';
                return;
            }
            
            if (total === 0) {
                document.getElementById('paginationWrapper').style.display = 'none';
                return;
            }

            document.getElementById('paginationWrapper').style.display = 'flex';
            
            const start = (currentPage - 1) * pageSize + 1;
            const end = Math.min(currentPage * pageSize, total);
            
            document.getElementById('pageStart').textContent = start;
            document.getElementById('pageEnd').textContent = end;
            document.getElementById('pageTotal').textContent = total;
            
            // Update buttons
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = currentPage === totalPages;
            
            // Generate page numbers
            const pageNumbers = document.getElementById('pageNumbers');
            let html = '';
            
            const maxVisible = 5;
            let startPage = Math.max(1, currentPage - Math.floor(maxVisible / 2));
            let endPage = Math.min(totalPages, startPage + maxVisible - 1);
            
            if (endPage - startPage < maxVisible - 1) {
                startPage = Math.max(1, endPage - maxVisible + 1);
            }
            
            if (startPage > 1) {
                html += `<button class="page-btn" onclick="goToPage(1)">1</button>`;
                if (startPage > 2) {
                    html += `<span style="color: #6b7280; padding: 0 8px;">...</span>`;
                }
            }
            
            for (let i = startPage; i <= endPage; i++) {
                html += `<button class="page-btn ${i === currentPage ? 'active' : ''}" onclick="goToPage(${i})">${i}</button>`;
            }
            
            if (endPage < totalPages) {
                if (endPage < totalPages - 1) {
                    html += `<span style="color: #6b7280; padding: 0 8px;">...</span>`;
                }
                html += `<button class="page-btn" onclick="goToPage(${totalPages})">${totalPages}</button>`;
            }
            
            pageNumbers.innerHTML = html;
        }

        function changePage(delta) {
            const newPage = currentPage + delta;
            if (newPage >= 1 && newPage <= totalPages) {
                currentPage = newPage;
                updatePagination();
                displayMatches();
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function goToPage(page) {
            currentPage = page;
            updatePagination();
            displayMatches();
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        function changePageSize() {
            pageSize = parseInt(document.getElementById('pageSize').value);
            currentPage = 1;
            updatePagination();
            displayMatches();
        }

        function displayMatches() {
            const container = document.getElementById('matchesGrid');
            
            // Pagination
            const start = (currentPage - 1) * pageSize;
            const end = start + pageSize;
            const paginatedMatches = filteredMatches.slice(start, end);
            
            if (paginatedMatches.length === 0) {
                container.innerHTML = `
                    <div class="no-data">
                        <i class="fas fa-search"></i>
                        <h3>No matches found</h3>
                        <p>Try adjusting your filters or search query</p>
                    </div>
                `;
                return;
            }

            // Generate unique ID for each match
            const getMatchId = (match) => {
                return `${match.sport}_${match.home_team}_${match.away_team}`.replace(/[^a-z0-9]/gi, '_');
            };

            // Get existing cards
            const existingCards = {};
            container.querySelectorAll('.match-card').forEach(card => {
                const id = card.dataset.matchId;
                if (id) existingCards[id] = card;
            });

            // Build new cards efficiently
            const newMatchIds = new Set();
            const fragment = document.createDocumentFragment();
            
            paginatedMatches.forEach(match => {
                const matchId = getMatchId(match);
                newMatchIds.add(matchId);
                
                const badges = [];
                if (match.bet365?.available) badges.push('<span class="bookmaker-badge badge-bet365">Bet365</span>');
                if (match.fanduel?.available) badges.push('<span class="bookmaker-badge badge-fanduel">FanDuel</span>');
                if (match['1xbet']?.available) badges.push('<span class="bookmaker-badge badge-1xbet">1xBet</span>');

                const sourcesCount = badges.length;

                const liveIndicator = match.is_live ? 
                    '<div class="live-indicator">LIVE</div>' : '';

                // Format live score display
                let scoreDisplay = '';
                if (match.is_live && match.score) {
                    const score = match.score;
                    const sport = match.sport?.toLowerCase() || '';
                    const homeScore = score.home_score || '0';
                    const awayScore = score.away_score || '0';
                    const period = score.period || '';
                    const timeRemaining = score.time_remaining || '';
                    
                    // Tennis-specific score display - simplified
                    if (sport.includes('tennis')) {
                        let setsInfo = '';
                        if (score.periods && score.periods.length > 0) {
                            // Show sets as simple chips
                            setsInfo = `
                                <div class="period-scores">
                                    ${score.periods.map((p, idx) => `
                                        <span class="period-score" title="Set ${idx + 1}">
                                            ${p.score1}-${p.score2}
                                        </span>
                                    `).join('')}
                                </div>
                            `;
                        }
                        
                        scoreDisplay = `
                            <div class="live-score-display">
                                <div class="score-row">
                                    <span class="score-value score-compact">${homeScore}</span>
                                    <span class="score-separator">-</span>
                                    <span class="score-value score-compact">${awayScore}</span>
                                </div>
                                ${setsInfo}
                                ${period ? `
                                    <div class="score-info">
                                        <span><i class="fas fa-trophy"></i> ${period}</span>
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    } else {
                        // Standard score display for other sports
                        // Check if we have detailed period scores
                        let periodScoresHtml = '';
                        if (score.periods && score.periods.length > 0) {
                            periodScoresHtml = `
                                <div class="period-scores">
                                    ${score.periods.map(p => `
                                        <span class="period-score" title="${p.period_name || 'Period ' + p.period}">
                                            ${p.score1}-${p.score2}
                                        </span>
                                    `).join('')}
                                </div>
                            `;
                        }
                        
                        scoreDisplay = `
                            <div class="live-score-display">
                                <div class="score-row">
                                    <span class="score-value">${homeScore}</span>
                                    <span class="score-separator">-</span>
                                    <span class="score-value">${awayScore}</span>
                                </div>
                                ${periodScoresHtml}
                                ${period || timeRemaining ? `
                                    <div class="score-info">
                                        ${period ? `<span><i class="fas fa-trophy"></i> ${period}</span>` : ''}
                                        ${timeRemaining ? `<span><i class="fas fa-clock"></i> ${timeRemaining}</span>` : ''}
                                    </div>
                                ` : ''}
                            </div>
                        `;
                    }
                }

                const cardHtml = `
                    <div class="match-card-header">
                        <span class="sport-badge">${match.sport}</span>
                        ${liveIndicator}
                    </div>
                    <div class="match-teams">
                        <div class="team">${match.home_team}</div>
                        <div class="vs-divider">${match.is_live && scoreDisplay ? '' : 'VS'}</div>
                        <div class="team">${match.away_team}</div>
                    </div>
                    ${scoreDisplay}
                    <div class="match-info">
                        <span><i class="fas fa-calendar"></i> ${match.date || 'TBD'}</span>
                        <span><i class="fas fa-clock"></i> ${match.time || 'TBD'}</span>
                    </div>
                    <div class="match-footer">
                        <div class="bookmaker-badges">${badges.join('')}</div>
                        <div class="sources-count">
                            <i class="fas fa-database"></i> ${sourcesCount} ${sourcesCount === 1 ? 'source' : 'sources'}
                        </div>
                    </div>
                `;

                // Check if card exists and needs update
                if (existingCards[matchId]) {
                    const existingCard = existingCards[matchId];
                    if (existingCard.innerHTML !== cardHtml) {
                        // Update only if content changed
                        existingCard.innerHTML = cardHtml;
                        existingCard.onclick = () => openMatchModal(match);
                        // Add brief highlight animation for updates
                        existingCard.classList.add('updated');
                        setTimeout(() => existingCard.classList.remove('updated'), 600);
                    }
                    fragment.appendChild(existingCard);
                } else {
                    // Create new card with fade-in animation
                    const cardDiv = document.createElement('div');
                    cardDiv.className = 'match-card new-card';
                    cardDiv.dataset.matchId = matchId;
                    cardDiv.innerHTML = cardHtml;
                    cardDiv.onclick = () => openMatchModal(match);
                    fragment.appendChild(cardDiv);
                    // Remove animation class after it completes
                    setTimeout(() => cardDiv.classList.remove('new-card'), 400);
                }
            });

            // Smart update: Only replace if needed, minimize flicker
            // Remove cards that no longer exist
            Array.from(container.children).forEach(child => {
                const id = child.dataset?.matchId;
                if (id && !newMatchIds.has(id)) {
                    child.remove();
                }
            });
            
            // Append new fragment (contains all cards in correct order)
            container.innerHTML = '';
            container.appendChild(fragment);
        }

        function openMatchModal(match) {
            const modal = document.getElementById('matchModal');
            const sourcesCount = [match.bet365?.available, match.fanduel?.available, match['1xbet']?.available].filter(Boolean).length;
            const matchType = match.is_live ? '<span style="color: #ef4444;"><i class="fas fa-circle"></i> LIVE</span>' : '<span style="color: #10b981;"><i class="fas fa-clock"></i> Pregame</span>';

            document.getElementById('modalTitle').textContent = `${match.home_team} vs ${match.away_team}`;
            
            // Build subtitle with score if live
            let subtitleHtml = `
                <span><i class="fas fa-trophy"></i> ${match.sport}</span>
                <span>${matchType}</span>
            `;
            
            // Add live score to subtitle if available
            if (match.is_live && match.score) {
                const score = match.score;
                const homeScore = score.home_score || '0';
                const awayScore = score.away_score || '0';
                subtitleHtml += `<span style="color: #3b82f6; font-weight: 700; font-size: 16px;"><i class="fas fa-chart-line"></i> ${homeScore} - ${awayScore}</span>`;
                
                if (score.period) {
                    subtitleHtml += `<span><i class="fas fa-hourglass-half"></i> ${score.period}</span>`;
                }
                if (score.time_remaining) {
                    subtitleHtml += `<span><i class="fas fa-clock"></i> ${score.time_remaining}</span>`;
                }
                
                // Add period-by-period scores if available
                if (score.periods && score.periods.length > 0) {
                    const periodsText = score.periods.map(p => `${p.period_name || 'P'+p.period}: ${p.score1}-${p.score2}`).join(' | ');
                    subtitleHtml += `<span style="font-size: 12px;"><i class="fas fa-list"></i> ${periodsText}</span>`;
                }
            }
            
            subtitleHtml += `
                <span><i class="fas fa-calendar"></i> ${match.date || 'TBD'}</span>
                <span><i class="fas fa-clock"></i> ${match.time || 'TBD'}</span>
                <span><i class="fas fa-chart-line"></i> ${sourcesCount} source(s)</span>
            `;
            
            document.getElementById('modalSubtitle').innerHTML = subtitleHtml;

            let bodyHtml = '';
            
            // Add statistics section if available (mainly from 1xBet)
            if (match.is_live && match.score && match.score.statistics && match.score.statistics.length > 0) {
                bodyHtml += `
                    <div class="statistics-section" style="background: #1a1a27; border: 1px solid #2a2a3e; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                        <h3 style="color: #ffffff; font-size: 16px; margin-bottom: 16px; display: flex; align-items: center; gap: 8px;">
                            <i class="fas fa-chart-bar"></i> Live Match Statistics
                        </h3>
                        <div style="display: grid; gap: 12px;">
                            ${match.score.statistics.map(stat => `
                                <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 12px; align-items: center;">
                                    <div style="text-align: right; font-weight: 600; color: #3b82f6;">${stat.value1}</div>
                                    <div style="font-size: 12px; color: #9ca3af; text-align: center; min-width: 120px;">${stat.name}</div>
                                    <div style="text-align: left; font-weight: 600; color: #ef4444;">${stat.value2}</div>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                `;
            }

            if (match.bet365?.available) bodyHtml += createBookmakerModal('Bet365', match.bet365, match, 'bet365');
            if (match.fanduel?.available) bodyHtml += createBookmakerModal('FanDuel', match.fanduel, match, 'fanduel');
            if (match['1xbet']?.available) bodyHtml += createBookmakerModal('1xBet', match['1xbet'], match, '1xbet');

            document.getElementById('modalBody').innerHTML = bodyHtml;
            modal.classList.add('show');
            document.body.style.overflow = 'hidden';
        }

        function closeModal() {
            document.getElementById('matchModal').classList.remove('show');
            document.body.style.overflow = '';
        }

        function createBookmakerModal(name, data, match, type) {
            const odds = data.odds || {};
            const iconClass = `icon-${type}`;
            
            let html = `
                <div class="bookmaker-section">
                    <div class="bookmaker-header">
                        <div class="bookmaker-name">
                            <div class="bookmaker-icon ${iconClass}">${name[0]}</div>
                            ${name}
                        </div>
                    </div>
                    <div class="odds-grid">
            `;

            if (type === 'fanduel') {
                if (odds.moneyline_home != null) {
                    html += `
                        <div class="odds-type-card">
                            <div class="odds-type-label"><i class="fas fa-dollar-sign"></i> Moneyline</div>
                            <div class="odds-values-grid">
                                <div class="odds-value-row">
                                    <span class="odds-team-label">${match.home_team}</span>
                                    <span class="odds-value">${odds.moneyline_home > 0 ? '+' : ''}${odds.moneyline_home}</span>
                                </div>
                                <div class="odds-value-row">
                                    <span class="odds-team-label">${match.away_team}</span>
                                    <span class="odds-value">${odds.moneyline_away > 0 ? '+' : ''}${odds.moneyline_away}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
                if (odds.spread_home_line != null) {
                    html += `
                        <div class="odds-type-card">
                            <div class="odds-type-label"><i class="fas fa-chart-line"></i> Spread</div>
                            <div class="odds-values-grid">
                                <div class="odds-value-row">
                                    <span class="odds-team-label">${match.home_team}</span>
                                    <span class="odds-value">${odds.spread_home_line > 0 ? '+' : ''}${odds.spread_home_line} (${odds.spread_home_odds})</span>
                                </div>
                                <div class="odds-value-row">
                                    <span class="odds-team-label">${match.away_team}</span>
                                    <span class="odds-value">${odds.spread_away_line > 0 ? '+' : ''}${odds.spread_away_line} (${odds.spread_away_odds})</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
                if (odds.total_line != null) {
                    html += `
                        <div class="odds-type-card">
                            <div class="odds-type-label"><i class="fas fa-bullseye"></i> Total</div>
                            <div class="odds-values-grid">
                                <div class="odds-value-row">
                                    <span class="odds-team-label">Over ${odds.total_line}</span>
                                    <span class="odds-value">${odds.total_over_odds}</span>
                                </div>
                                <div class="odds-value-row">
                                    <span class="odds-team-label">Under ${odds.total_line}</span>
                                    <span class="odds-value">${odds.total_under_odds}</span>
                                </div>
                            </div>
                        </div>
                    `;
                }
            } else if (type === '1xbet') {
                if (odds.moneyline_home || odds.moneyline_away) {
                    html += `<div class="odds-type-card"><div class="odds-type-label"><i class="fas fa-dollar-sign"></i> Moneyline</div><div class="odds-values-grid">
                        <div class="odds-value-row"><span class="odds-team-label">${match.home_team}</span><span class="odds-value">${odds.moneyline_home || 'N/A'}</span></div>
                        <div class="odds-value-row"><span class="odds-team-label">${match.away_team}</span><span class="odds-value">${odds.moneyline_away || 'N/A'}</span></div>
                    </div></div>`;
                }
                if (odds.spread_home || odds.spread_away) {
                    html += `<div class="odds-type-card"><div class="odds-type-label"><i class="fas fa-chart-line"></i> Handicap</div><div class="odds-values-grid">
                        <div class="odds-value-row"><span class="odds-team-label">${match.home_team}</span><span class="odds-value">${odds.spread_home || 'N/A'}</span></div>
                        <div class="odds-value-row"><span class="odds-team-label">${match.away_team}</span><span class="odds-value">${odds.spread_away || 'N/A'}</span></div>
                    </div></div>`;
                }
                if (odds.total_over || odds.total_under) {
                    html += `<div class="odds-type-card"><div class="odds-type-label"><i class="fas fa-bullseye"></i> Total</div><div class="odds-values-grid">
                        <div class="odds-value-row"><span class="odds-team-label">Over</span><span class="odds-value">${odds.total_over || 'N/A'}</span></div>
                        <div class="odds-value-row"><span class="odds-team-label">Under</span><span class="odds-value">${odds.total_under || 'N/A'}</span></div>
                    </div></div>`;
                }
            } else {
                // Bet365
                if (odds.moneyline?.length >= 2) {
                    html += `<div class="odds-type-card"><div class="odds-type-label"><i class="fas fa-dollar-sign"></i> Moneyline</div><div class="odds-values-grid">
                        <div class="odds-value-row"><span class="odds-team-label">${match.home_team}</span><span class="odds-value">${odds.moneyline[0]}</span></div>
                        <div class="odds-value-row"><span class="odds-team-label">${match.away_team}</span><span class="odds-value">${odds.moneyline[1]}</span></div>
                    </div></div>`;
                }
                if (odds.spread?.length >= 2) {
                    html += `<div class="odds-type-card"><div class="odds-type-label"><i class="fas fa-chart-line"></i> Spread</div><div class="odds-values-grid">
                        <div class="odds-value-row"><span class="odds-team-label">${match.home_team}</span><span class="odds-value">${odds.spread[0]}</span></div>
                        <div class="odds-value-row"><span class="odds-team-label">${match.away_team}</span><span class="odds-value">${odds.spread[1]}</span></div>
                    </div></div>`;
                }
                if (odds.total?.length >= 2) {
                    html += `<div class="odds-type-card"><div class="odds-type-label"><i class="fas fa-bullseye"></i> Total</div><div class="odds-values-grid">
                        <div class="odds-value-row"><span class="odds-team-label">Over/Under</span><span class="odds-value">${odds.total[0]} / ${odds.total[1]}</span></div>
                    </div></div>`;
                }
            }

            html += `</div></div>`;
            return html;
        }

        // Debounce helper function
        function debounce(func, wait) {
            let timeout;
            return function executedFunction(...args) {
                const later = () => {
                    clearTimeout(timeout);
                    func(...args);
                };
                clearTimeout(timeout);
                timeout = setTimeout(later, wait);
            };
        }

        // Search functionality with minimal debouncing (150ms for responsive feel)
        const debouncedSearch = debounce((value) => {
            searchQuery = value;
            applyFilters();
        }, 150);

        document.getElementById('searchInput').addEventListener('input', (e) => {
            debouncedSearch(e.target.value);
        });

        // Close modal on ESC key
        document.addEventListener('keydown', (e) => {
            if (e.key === 'Escape') closeModal();
        });

        // Monitoring Dashboard Functions
        function toggleMonitoring() {
            const content = document.getElementById('monitoringContent');
            const chevron = document.getElementById('monitoringChevron');
            
            if (content.classList.contains('show')) {
                content.classList.remove('show');
                chevron.style.transform = 'rotate(0deg)';
            } else {
                content.classList.add('show');
                chevron.style.transform = 'rotate(180deg)';
                fetchMonitoringStatus();
            }
        }

        async function fetchMonitoringStatus() {
            try {
                const response = await fetch('/api/monitoring');
                const data = await response.json();
                
                updateMonitoringDashboard(data);
            } catch (error) {
                console.error('Error fetching monitoring status:', error);
                document.getElementById('monitoringBadge').textContent = 'Error';
                document.getElementById('monitoringBadge').className = 'monitoring-badge inactive';
            }
        }

        function updateMonitoringDashboard(data) {
            const dashboard = document.getElementById('monitoringDashboard');
            dashboard.style.display = 'block';
            
            // Update badge
            const badge = document.getElementById('monitoringBadge');
            if (data.monitoring_active) {
                badge.textContent = 'Active';
                badge.className = 'monitoring-badge active';
            } else {
                badge.textContent = 'Inactive';
                badge.className = 'monitoring-badge inactive';
            }

            // Update last update time
            const lastUpdateEl = document.getElementById('monitoringLastUpdate');
            if (data.last_updated) {
                try {
                    const updateTime = new Date(data.last_updated);
                    const now = new Date();
                    const diffSeconds = Math.floor((now - updateTime) / 1000);
                    
                    let timeText;
                    if (diffSeconds < 60) {
                        timeText = `${diffSeconds}s ago`;
                    } else if (diffSeconds < 3600) {
                        timeText = `${Math.floor(diffSeconds / 60)}m ago`;
                    } else {
                        timeText = `${Math.floor(diffSeconds / 3600)}h ago`;
                    }
                    
                    lastUpdateEl.textContent = `Updated ${timeText}`;
                    
                    // Warn if data is stale
                    if (diffSeconds > 600) { // 10 minutes
                        lastUpdateEl.style.color = '#ff6b6b';
                    } else {
                        lastUpdateEl.style.color = '#888';
                    }
                } catch (e) {
                    lastUpdateEl.textContent = 'Update time unknown';
                }
            } else {
                lastUpdateEl.textContent = 'Never updated';
            }

            // Update summary cards
            if (data.summary) {
                document.getElementById('healthyCount').textContent = data.summary.healthy || 0;
                document.getElementById('warningCount').textContent = data.summary.warnings || 0;
                document.getElementById('errorCount').textContent = data.summary.errors || 0;
            }

            // Update email status
            document.getElementById('emailStatus').textContent = data.email_enabled ? 'Enabled' : 'Disabled';

            // Update module list
            const moduleList = document.getElementById('moduleStatusList');
            if (data.modules) {
                let html = '';
                for (const [moduleName, moduleData] of Object.entries(data.modules)) {
                    const statusClass = moduleData.status || 'error';
                    const matchCount = moduleData.match_count || 0;
                    const fileAge = moduleData.file_age_minutes || 0;
                    const ageText = fileAge < 60 ? `${fileAge.toFixed(0)}m ago` : `${(fileAge / 60).toFixed(1)}h ago`;
                    
                    html += `
                        <div class="module-status-item">
                            <div class="module-name">${moduleName}</div>
                            <div class="module-info">
                                <span>${matchCount} matches</span>
                                <span>${ageText}</span>
                                <span class="module-status-badge ${statusClass}">${statusClass}</span>
                            </div>
                        </div>
                    `;
                }
                moduleList.innerHTML = html;
            }
        }

        // Auto-refresh monitoring status (lightweight check)
        setInterval(() => {
            fetchMonitoringStatus();
        }, 15000); // Every 15 seconds - balance between real-time and performance

        // Initialize
        connect();
        fetchMonitoringStatus(); // Fetch immediately on load
    </script>
</body>
</html>
